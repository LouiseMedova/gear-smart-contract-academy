"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PAGE_SIZE = exports.getInitialLength = exports.ab2str = exports.getExportValue = exports.readMetaValue = void 0;
function readMetaValue(memory, func) {
    return ab2str(getExportValue(memory, func));
}
exports.readMetaValue = readMetaValue;
function getExportValue(memory, func) {
    if (!func) {
        return undefined;
    }
    const result_ptr = func();
    const pointer = new Uint32Array(memory.buffer.slice(result_ptr, result_ptr + 4))[0];
    const length = new Uint32Array(memory.buffer.slice(result_ptr + 4, result_ptr + 8))[0];
    const buf = memory.buffer.slice(pointer, pointer + length);
    return buf;
}
exports.getExportValue = getExportValue;
function ab2str(buf) {
    return String.fromCharCode.apply(null, new Uint8Array(buf));
}
exports.ab2str = ab2str;
function getInitialLength(pages) {
    return (parseInt(Object.keys(pages).reduce((prev, cur) => {
        if (parseInt(cur) > parseInt(prev)) {
            return cur;
        }
        return prev;
    })) + 1);
}
exports.getInitialLength = getInitialLength;
exports.PAGE_SIZE = 4096;
